!function(t){function o(s){if(i[s])return i[s].exports;var e=i[s]={exports:{},id:s,loaded:!1};return t[s].call(e.exports,e,e.exports,o),e.loaded=!0,e.exports}var i={};return o.m=t,o.c=i,o.p="",o(0)}([function(t,o,i){!function(){function t(){for(var t;"undefined"==typeof t||""==t||null==t;)t=prompt("请输入您的昵称~");for(var o;"undefined"==typeof o||""==o||null==t;)o=prompt("请输入房间号");var i=1e8*Math.random();return{userName:t,roomId:o,token:i}}var o=i(2),s=new o("self"),e=new o("com");window.WebSocket||(alert("您的浏览器不支持多人2048，请升级！"),window.close());var r=t(),a=new WebSocket("ws://127.0.0.1:9501");a.userName=r.userName,a.roomId=r.roomId,a.token=r.token,a.onopen=function(){console.log("connection success"),s.init(a),e.init();var t={code:0,user:r.userName,roomId:r.roomId,token:r.token,beginPos:s.beginPos},o=JSON.stringify(t);a.send(o),s.createBlock()},a.onmessage=function(t){var o=JSON.parse(t.data);console.log(o),-1==o.code&&(alert("对方已离开房间,您可以继续玩！"),e.init()),1==o.code&&(e.setNameBox(o.comp),e.beginPos=o.beginPos,e.createBlock()),2==o.code&&(e.beginPos=o.beginPos,e.slide(o.actionCode)),3==o.code&&alert("你赢了,可以继续玩!")},a.onclose=function(){console.log("断开连接")},a.onerror=function(){console.log("error")}}()},function(t,o){function i(){this.number=0,this.position=function(t,o){this.x=t,this.y=o,this.block.style.marginLeft=t*(this.width+this.offset)+"px",this.block.style.marginTop=o*(this.height+this.offset)+"px"},this.create=function(t,o,i){var s=document.createElement("div");s.className="block",this.block=s,this.width=this.height=100,this.x=t,this.y=o,this.offset=7,this.position(t,o),i.appendChild(s)},this.setNumber=function(t){switch(this.number=t,this.block.innerHTML=t,parseInt(this.number)){case 2:this.block.style.backgroundColor="#3399cc",this.block.style.color="white";break;case 4:this.block.style.backgroundColor="#ff9900",this.block.style.color="white";break;case 8:this.block.style.backgroundColor="#ffcc33",this.block.style.color="white";break;case 16:this.block.style.backgroundColor="#ff6600",this.block.style.color="white";break;case 32:this.block.style.backgroundColor="#009966",this.block.style.color="white";break;case 64:this.block.style.backgroundColor="#33cc99",this.block.style.color="white";break;case 128:this.block.style.backgroundColor="#cc6600",this.block.style.color="white";break;case 256:this.block.style.backgroundColor="#cccc33",this.block.style.color="white";break;case 512:this.block.style.backgroundColor="#663399",this.block.style.color="white";break;case 1024:this.block.style.backgroundColor="#ff6666",this.block.style.color="white";break;case 2048:this.block.style.backgroundColor="#333399",this.block.style.color="white";break;case 4096:this.block.style.backgroundColor="#cc3366",this.block.style.color="white";break;case 8192:this.block.style.backgroundColor="#666666",this.block.style.color="white";break;case 16384:this.block.style.backgroundColor="#996600",this.block.style.color="white";break;case 32768:this.block.style.backgroundColor="#003300",this.block.style.color="white";break;case 65536:this.block.style.backgroundColor="#ccccff",this.block.style.color="white";break;case 131072:this.block.style.backgroundColor="#336666",this.block.style.color="white";break;case 262144:this.block.style.backgroundColor="#cc9966",this.block.style.color="white";break;case 524288:this.block.style.backgroundColor="#996633",this.block.style.color="white"}}}t.exports=i},function(t,o,i){function s(t){this.stage=document.getElementById(t+"Stage"),this.scoreBox=document.getElementById(t+"Score"),this.nameBox=document.getElementById(t+"Name"),this.control=t,this.init=function(){arguments[0]&&(this.ws=arguments[0],this.nameBox.innerHTML=arguments[0].userName);var t=this;this.clearStage(),this.score=0,this.map=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.blkArr=[],this.maxNum=0,this.score=0,this.isKeyDown=0,this.isMove=0,this.beginPos=[],"self"==this.control&&(t.rand(),t.rand(),t.rand(),window.onkeydown=function(o){if(!t.isKeyDown){var i=o||window.event;i&&(t.isKeyDown=1,t.slide(i.keyCode))}},window.onkeyup=function(){t.isKeyDown=0}),setInterval(function(){t.scoreBox.innerHTML=t.score},10)},this.createBlock=function(){for(;this.beginPos.length;){var t=new e,o=this.beginPos.shift(),i=o.x,s=o.y;this.blkArr.push(t),t.create(i,s,this.stage),t.setNumber(o.num),this.map[s][i]=t}},this.rand=function(){var t,o,i=Math.random()<=.6?2:4;for(t=Math.floor(4*Math.random()),o=Math.floor(4*Math.random());0!=this.map[o][t]||4==t||4==o;)t=Math.floor(4*Math.random()),o=Math.floor(4*Math.random());this.beginPos.push({x:t,y:o,num:i}),this.map[o][t]=1},this.setNameBox=function(t){this.nameBox.innerHTML=t},this.merge=function(t,o){var i=t.block.innerHTML,s=o.block.innerHTML;if(i==s){this.isMove||(this.isMove=1);var e=t.x,r=t.y;t.position(o.x,o.y),o.setNumber(2*s),t.block.style.zIndex=-1,this.map[r][e]=0,this.score+=2*s;var a=this;return setTimeout(function(){a.stage.removeChild(t.block),delete t},300),!0}return!1},this.slide=function(t){var o,i,s,e;if(37==t)for(o=0;4>o;o++){for(s=0,i=0;3>i;i++)if(0==this.map[o][i]){for(0==s&&(s=i+1);4>s&&0==this.map[o][s]&&s++;);if(4==s)break;this.map[o][s].position(i,o),this.map[o][i]=this.map[o][s],this.map[o][s]=0}for(i=0;3>i;i++)if(0!=this.map[o][i]&&0!=this.map[o][i+1]&&this.merge(this.map[o][i+1],this.map[o][i]))for(e=s=i+1;4>s;)0!=this.map[o][s]&&(this.map[o][s].position(e,o),this.map[o][e++]=this.map[o][s],this.map[o][s]=0),s++;for(s=0,i=0;3>i;i++)if(0==this.map[o][i]){for(0==s&&(s=i+1);4>s&&0==this.map[o][s]&&s++;);if(4==s)break;this.map[o][s].position(i,o),this.map[o][i]=this.map[o][s],this.map[o][s]=0}}if(38==t)for(o=0;4>o;o++){for(s=0,i=0;3>i;i++)if(0==this.map[i][o]){for(0==s&&(s=i+1);4>s&&0==this.map[s][o]&&s++;);if(4==s)break;this.map[s][o].position(o,i),this.map[i][o]=this.map[s][o],this.map[s][o]=0}for(i=0;3>i;i++)if(0!=this.map[i][o]&&0!=this.map[i+1][o]&&this.merge(this.map[i+1][o],this.map[i][o]))for(e=s=i+1;4>s;)0!=this.map[s][o]&&(this.map[s][o].position(o,e),this.map[e++][o]=this.map[s][o],this.map[s][o]=0),s++;for(s=0,i=0;3>i;i++)if(0==this.map[i][o]){for(0==s&&(s=i+1);4>s&&0==this.map[s][o]&&s++;);if(4==s)break;this.map[s][o].position(o,i),this.map[i][o]=this.map[s][o],this.map[s][o]=0}}if(39==t)for(o=0;4>o;o++){for(s=3,i=3;i>=1;i--)if(0==this.map[o][i]){for(3==s&&(s=i-1);s>=0&&0==this.map[o][s]&&s--;);if(-1==s)break;this.map[o][s].position(i,o),this.map[o][i]=this.map[o][s],this.map[o][s]=0}for(i=3;i>=1;i--)if(0!=this.map[o][i]&&0!=this.map[o][i-1]&&this.merge(this.map[o][i-1],this.map[o][i]))for(e=s=i-1;s>=0;)0!=this.map[o][s]&&(this.map[o][s].position(e,o),this.map[o][e--]=this.map[o][s],this.map[o][s]=0),s--;for(s=3,i=3;i>=1;i--)if(0==this.map[o][i]){for(3==s&&(s=i-1);s>=0&&0==this.map[o][s]&&s--;);if(-1==s)break;this.map[o][s].position(i,o),this.map[o][i]=this.map[o][s],this.map[o][s]=0}}if(40==t)for(o=0;4>o;o++){for(s=3,i=3;i>=1;i--)if(0==this.map[i][o]){for(3==s&&(s=i-1);s>=0&&0==this.map[s][o]&&s--;);if(-1==s)break;this.map[s][o].position(o,i),this.map[i][o]=this.map[s][o],this.map[s][o]=0}for(i=3;i>=1;i--)if(0!=this.map[i][o]&&0!=this.map[i-1][o]&&this.merge(this.map[i-1][o],this.map[i][o]))for(e=s=i-1;s>=0;)0!=this.map[s][o]&&(this.map[s][o].position(o,e),this.map[e--][o]=this.map[s][o],this.map[s][o]=0),s--;for(s=3,i=3;i>=1;i--)if(0==this.map[i][o]){for(3==s&&(s=i-1);s>=0&&0==this.map[s][o]&&s--;);if(-1==s)break;this.map[s][o].position(o,i),this.map[i][o]=this.map[s][o],this.map[s][o]=0}}if(40>=t&&t>=37){var r,a=this;setTimeout(function(){var s=0;for(o=0;4>o;o++)for(i=0;4>i;i++)0!=a.map[o][i]&&(s++,a.map[o][i].block.innerHTML>a.maxNum&&(a.maxNum=a.map[o][i].block.innerHTML));16!=s||a.isMove?(a.isMove=0,"self"==a.control&&(a.rand(),r={code:2,user:a.ws.userName,roomId:a.ws.roomId,token:a.ws.token,actionCode:t,beginPos:a.beginPos},a.ws.send(JSON.stringify(r))),a.createBlock()):(alert("你输了!"),r={code:-2,user:a.ws.userName,roomId:a.ws.roomId,token:a.ws.token},a.ws.send(JSON.stringify(r)),a.init())},300)}},this.clearStage=function(){for(;this.stage.hasChildNodes();)this.stage.removeChild(this.stage.firstChild)}}var e=i(1);t.exports=s}]);