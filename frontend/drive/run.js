!function(o){function t(e){if(s[e])return s[e].exports;var i=s[e]={exports:{},id:e,loaded:!1};return o[e].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var s={};return t.m=o,t.c=s,t.p="",t(0)}([function(o,t,s){!function(){function o(){if(!this.isClick){this.isClick=1,r.init(l),a.init(),this.innerHTML="已准备",this.style.backgroundColor="#1b76c4";var o={code:0,user:h.userName,roomId:h.roomId,token:h.token,beginPos:r.beginPos};l.send(JSON.stringify(o))}}function t(){n.innerHTML="准备",c.innerHTML="未准备",n.style.backgroundColor="#24a7f0",c.style.color="cornflowerblue"}var e=s(3),i=s(1),r=new e("self"),a=new e("com"),n=document.getElementById("readyBtn"),c=document.getElementsByClassName("state")[0];n.isClick=1,n.addEventListener("click",o),window.WebSocket||(alert("您的浏览器不支持多人2048，请升级！"),window.close());var h=i.getUserInfo(),l=new WebSocket("ws://127.0.0.1:9501");l.userName=h.userName,l.roomId=h.roomId,l.token=h.token,l.onopen=function(){console.log("connection success"),r.setNameBox(h.userName);var o={code:100,user:h.userName,roomId:h.roomId,token:h.token};l.send(JSON.stringify(o))},l.onmessage=function(o){var s=JSON.parse(o.data);if(100==s.code&&(a.setNameBox(s.comp),n.isClick=0),-50==s.code){for(h.roomId=prompt("房间已满，请重新输入房间号:");"undefined"==typeof h.roomId||""==h.roomId;)h.roomId=prompt("房间已满，请重新输入房间号:");l.roomId=h.roomId;var e={code:100,user:h.userName,roomId:h.roomId,token:h.token};l.send(JSON.stringify(e))}if(0==s.code&&(c.innerHTML="已准备",c.style.color="coral"),-1==s.code&&(i.asyncAlert("对方已离开房间,您可以继续玩！"),a.init(),a.setNameBox("虚位以待"),t()),1==s.code&&(c.innerHTML="进行中",c.style.color="coral",n.innerHTML="进行中",n.backgroundColor="coral",r.createBlock(),a.beginPos=s.beginPos,a.createBlock()),2==s.code){for(var m=0;m<s.beginPos.length;m++){for(var f=s.beginPos[m],p=0,k=0;k<a.beginPos.length;k++){var b=a.beginPos[k];if(f.x==b.x&&f.y==b.y&&f.num==b.num){p=1;break}}p||a.beginPos.push(f)}a.slide(s.actionCode)}3!=s.code&&-3!=s.code&&66!=s.code||(3==s.code?i.asyncAlert("你赢了!"):-3==s.code?i.asyncAlert("你输了!"):i.asyncAlert("平局！"),t(),a.init(),r.init(),n.isClick=0)},l.onclose=function(){console.log("断开连接")},l.onerror=function(){console.log("error")}}()},function(o,t){function s(){for(var o;"undefined"==typeof o||""==o||null==o;)o=prompt("请输入您的昵称~");for(var t;"undefined"==typeof t||""==t||null==o;)t=prompt("请输入房间号");var s=1e12*Math.random();return{userName:o,roomId:t,token:s}}function e(o){setTimeout(function(){alert(o)},0)}o.exports={getUserInfo:s,asyncAlert:e}},function(o,t){function s(){this.number=0,this.position=function(o,t){this.x=o,this.y=t,this.block.style.marginLeft=o*(this.width+this.offset)+"px",this.block.style.marginTop=t*(this.height+this.offset)+"px"},this.create=function(o,t,s){var e=document.createElement("div");e.className="block",this.block=e,this.width=this.height=100,this.x=o,this.y=t,this.offset=7,this.position(o,t),s.appendChild(e)},this.setNumber=function(o){switch(this.number=o,this.block.innerHTML=o,parseInt(this.number)){case 2:this.block.style.backgroundColor="#3399cc",this.block.style.color="white";break;case 4:this.block.style.backgroundColor="#ff9900",this.block.style.color="white";break;case 8:this.block.style.backgroundColor="#ffcc33",this.block.style.color="white";break;case 16:this.block.style.backgroundColor="#ff6600",this.block.style.color="white";break;case 32:this.block.style.backgroundColor="#009966",this.block.style.color="white";break;case 64:this.block.style.backgroundColor="#33cc99",this.block.style.color="white";break;case 128:this.block.style.backgroundColor="#cc6600",this.block.style.color="white";break;case 256:this.block.style.backgroundColor="#cccc33",this.block.style.color="white";break;case 512:this.block.style.backgroundColor="#663399",this.block.style.color="white";break;case 1024:this.block.style.backgroundColor="#ff6666",this.block.style.color="white";break;case 2048:this.block.style.backgroundColor="#333399",this.block.style.color="white";break;case 4096:this.block.style.backgroundColor="#cc3366",this.block.style.color="white";break;case 8192:this.block.style.backgroundColor="#666666",this.block.style.color="white";break;case 16384:this.block.style.backgroundColor="#996600",this.block.style.color="white";break;case 32768:this.block.style.backgroundColor="#003300",this.block.style.color="white";break;case 65536:this.block.style.backgroundColor="#ccccff",this.block.style.color="white";break;case 131072:this.block.style.backgroundColor="#336666",this.block.style.color="white";break;case 262144:this.block.style.backgroundColor="#cc9966",this.block.style.color="white";break;case 524288:this.block.style.backgroundColor="#996633",this.block.style.color="white"}}}o.exports=s},function(o,t,s){function e(o){this.stage=document.getElementById(o+"Stage"),this.scoreBox=document.getElementById(o+"Score"),this.nameBox=document.getElementById(o+"Name"),this.control=o,this.init=function(){arguments[0]&&(this.ws=arguments[0],this.setNameBox(arguments[0].userName)),this.clearStage(),this.score=0,this.map=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.blkArr=[],this.maxNum=0,this.score=0,this.isKeyDown=0,this.isMove=0,this.moveNum=0,this.beginPos=[],"self"==this.control&&(this.rand(),this.rand(),this.rand(),window.onkeydown=function(t){if(!(o.isKeyDown||o.moveNum>=1)){var s=t||window.event;s&&s.keyCode>=37&&s.keyCode<=40&&(o.isKeyDown=1,o.slide(s.keyCode),o.moveNum++)}},window.onkeyup=function(){o.isKeyDown=0});var o=this;setInterval(function(){o.scoreBox.innerHTML=o.score},10)},this.createBlock=function(){for(var o="undefined"==typeof arguments[0]?null:arguments[0];this.beginPos.length;){var t=new i,s=this.beginPos.shift(),e=s.x,r=s.y;if(this.blkArr.push(t),t.create(e,r,this.stage),t.setNumber(s.num),this.map[r][e]=t,o&&(o--,!o))break}},this.rand=function(){var o,t,s=Math.random()<=.6?2:4;for(o=Math.floor(4*Math.random()),t=Math.floor(4*Math.random());0!=this.map[t][o]||4==o||4==t;)o=Math.floor(4*Math.random()),t=Math.floor(4*Math.random());this.beginPos.push({x:o,y:t,num:s}),this.map[t][o]=1},this.setNameBox=function(o){this.nameBox.innerHTML=o},this.merge=function(o,t){var s=o.block.innerHTML,e=t.block.innerHTML;if(s==e){this.isMove||(this.isMove=1);var i=o.x,r=o.y;o.position(t.x,t.y),t.setNumber(2*e),o.block.style.zIndex=-1,this.map[r][i]=0,this.score+=2*e;var a=this;return setTimeout(function(){a.stage.removeChild(o.block),delete o},300),!0}return!1},this.slide=function(o){var t,s,e,i;if(37==o)for(t=0;4>t;t++){for(e=0,s=0;3>s;s++)if(0==this.map[t][s]){for(0==e&&(e=s+1);4>e&&0==this.map[t][e]&&e++;);if(4==e)break;this.map[t][e].position(s,t),this.map[t][s]=this.map[t][e],this.map[t][e]=0}for(s=0;3>s;s++)if(0!=this.map[t][s]&&0!=this.map[t][s+1]&&this.merge(this.map[t][s+1],this.map[t][s]))for(i=e=s+1;4>e;)0!=this.map[t][e]&&(this.map[t][e].position(i,t),this.map[t][i++]=this.map[t][e],this.map[t][e]=0),e++;for(e=0,s=0;3>s;s++)if(0==this.map[t][s]){for(0==e&&(e=s+1);4>e&&0==this.map[t][e]&&e++;);if(4==e)break;this.map[t][e].position(s,t),this.map[t][s]=this.map[t][e],this.map[t][e]=0}}if(38==o)for(t=0;4>t;t++){for(e=0,s=0;3>s;s++)if(0==this.map[s][t]){for(0==e&&(e=s+1);4>e&&0==this.map[e][t]&&e++;);if(4==e)break;this.map[e][t].position(t,s),this.map[s][t]=this.map[e][t],this.map[e][t]=0}for(s=0;3>s;s++)if(0!=this.map[s][t]&&0!=this.map[s+1][t]&&this.merge(this.map[s+1][t],this.map[s][t]))for(i=e=s+1;4>e;)0!=this.map[e][t]&&(this.map[e][t].position(t,i),this.map[i++][t]=this.map[e][t],this.map[e][t]=0),e++;for(e=0,s=0;3>s;s++)if(0==this.map[s][t]){for(0==e&&(e=s+1);4>e&&0==this.map[e][t]&&e++;);if(4==e)break;this.map[e][t].position(t,s),this.map[s][t]=this.map[e][t],this.map[e][t]=0}}if(39==o)for(t=0;4>t;t++){for(e=3,s=3;s>=1;s--)if(0==this.map[t][s]){for(3==e&&(e=s-1);e>=0&&0==this.map[t][e]&&e--;);if(-1==e)break;this.map[t][e].position(s,t),this.map[t][s]=this.map[t][e],this.map[t][e]=0}for(s=3;s>=1;s--)if(0!=this.map[t][s]&&0!=this.map[t][s-1]&&this.merge(this.map[t][s-1],this.map[t][s]))for(i=e=s-1;e>=0;)0!=this.map[t][e]&&(this.map[t][e].position(i,t),this.map[t][i--]=this.map[t][e],this.map[t][e]=0),e--;for(e=3,s=3;s>=1;s--)if(0==this.map[t][s]){for(3==e&&(e=s-1);e>=0&&0==this.map[t][e]&&e--;);if(-1==e)break;this.map[t][e].position(s,t),this.map[t][s]=this.map[t][e],this.map[t][e]=0}}if(40==o)for(t=0;4>t;t++){for(e=3,s=3;s>=1;s--)if(0==this.map[s][t]){for(3==e&&(e=s-1);e>=0&&0==this.map[e][t]&&e--;);if(-1==e)break;this.map[e][t].position(t,s),this.map[s][t]=this.map[e][t],this.map[e][t]=0}for(s=3;s>=1;s--)if(0!=this.map[s][t]&&0!=this.map[s-1][t]&&this.merge(this.map[s-1][t],this.map[s][t]))for(i=e=s-1;e>=0;)0!=this.map[e][t]&&(this.map[e][t].position(t,i),this.map[i--][t]=this.map[e][t],this.map[e][t]=0),e--;for(e=3,s=3;s>=1;s--)if(0==this.map[s][t]){for(3==e&&(e=s-1);e>=0&&0==this.map[e][t]&&e--;);if(-1==e)break;this.map[e][t].position(t,s),this.map[s][t]=this.map[e][t],this.map[e][t]=0}}var a,n=this;setTimeout(function(){var e=0;for(t=0;4>t;t++)for(s=0;4>s;s++)0!=n.map[t][s]&&(e++,n.map[t][s].block.innerHTML>n.maxNum&&(n.maxNum=n.map[t][s].block.innerHTML));16!=e||n.isMove?(n.isMove=0,"self"==n.control&&(n.moveNum--,n.rand(),a={code:2,user:n.ws.userName,roomId:n.ws.roomId,token:n.ws.token,actionCode:o,beginPos:n.beginPos},n.ws.send(JSON.stringify(a))),n.createBlock(1)):(r.asyncAlert("游戏结束,您的分数为["+n.score+"]."),a={code:-2,user:n.ws.userName,roomId:n.ws.roomId,token:n.ws.token,score:n.score},n.ws.send(JSON.stringify(a)),n.init())},250)},this.clearStage=function(){for(;this.stage.hasChildNodes();)this.stage.removeChild(this.stage.firstChild)}}var i=s(2),r=s(1);o.exports=e}]);