!function(o){function t(s){if(i[s])return i[s].exports;var e=i[s]={exports:{},id:s,loaded:!1};return o[s].call(e.exports,e,e.exports,t),e.loaded=!0,e.exports}var i={};return t.m=o,t.c=i,t.p="",t(0)}([function(o,t,i){!function(){function o(){if(!this.isClick){this.isClick=1,r.init(l),a.init(),this.innerHTML="已准备",this.style.backgroundColor="#1b76c4";var o={code:0,user:c.userName,roomId:c.roomId,token:c.token,beginPos:r.beginPos};l.send(JSON.stringify(o))}}function t(){n.innerHTML="准备",h.innerHTML="未准备",n.style.backgroundColor="#24a7f0",h.style.color="cornflowerblue"}var s=i(2),e=i(3),r=new s("self"),a=new s("com"),n=document.getElementById("readyBtn"),h=document.getElementsByClassName("state")[0];n.isClick=1,n.addEventListener("click",o),window.WebSocket||(alert("您的浏览器不支持多人2048，请升级！"),window.close());var c=e.getUserInfo(),l=new WebSocket("ws://127.0.0.1:9501");l.userName=c.userName,l.roomId=c.roomId,l.token=c.token,l.onopen=function(){console.log("connection success"),r.setNameBox(c.userName);var o={code:100,user:c.userName,roomId:c.roomId,token:c.token};l.send(JSON.stringify(o))},l.onmessage=function(o){var i=JSON.parse(o.data);if(100==i.code&&(a.setNameBox(i.comp),n.isClick=0),-50==i.code){for(c.roomId=prompt("房间已满，请重新输入房间号:");"undefined"==typeof c.roomId||""==c.roomId;)c.roomId=prompt("房间已满，请重新输入房间号:");l.roomId=c.roomId;var s={code:100,user:c.userName,roomId:c.roomId,token:c.token};l.send(JSON.stringify(s))}if(0==i.code&&(h.innerHTML="已准备",h.style.color="coral"),-1==i.code&&(e.asyncAlert("对方已离开房间,您可以继续玩！"),a.init(),a.setNameBox("虚位以待"),t()),1==i.code&&(h.innerHTML="进行中",h.style.color="coral",n.innerHTML="进行中",n.backgroundColor="coral",r.createBlock(),a.beginPos=i.beginPos,a.createBlock()),2==i.code){for(var m=0;m<i.beginPos.length;m++){for(var f=i.beginPos[m],p=0,k=0;k<a.beginPos.length;k++){var b=a.beginPos[k];if(f.x==b.x&&f.y==b.y&&f.num==b.num){p=1;break}}p||a.beginPos.push(f)}a.slide(i.actionCode)}3!=i.code&&-3!=i.code||(3==i.code?e.asyncAlert("你赢了!"):e.asyncAlert("你输了!"),t(),a.init(),r.init(),n.isClick=0)},l.onclose=function(){console.log("断开连接")},l.onerror=function(){console.log("error")}}()},function(o,t){function i(){this.number=0,this.position=function(o,t){this.x=o,this.y=t,this.block.style.marginLeft=o*(this.width+this.offset)+"px",this.block.style.marginTop=t*(this.height+this.offset)+"px"},this.create=function(o,t,i){var s=document.createElement("div");s.className="block",this.block=s,this.width=this.height=100,this.x=o,this.y=t,this.offset=7,this.position(o,t),i.appendChild(s)},this.setNumber=function(o){switch(this.number=o,this.block.innerHTML=o,parseInt(this.number)){case 2:this.block.style.backgroundColor="#3399cc",this.block.style.color="white";break;case 4:this.block.style.backgroundColor="#ff9900",this.block.style.color="white";break;case 8:this.block.style.backgroundColor="#ffcc33",this.block.style.color="white";break;case 16:this.block.style.backgroundColor="#ff6600",this.block.style.color="white";break;case 32:this.block.style.backgroundColor="#009966",this.block.style.color="white";break;case 64:this.block.style.backgroundColor="#33cc99",this.block.style.color="white";break;case 128:this.block.style.backgroundColor="#cc6600",this.block.style.color="white";break;case 256:this.block.style.backgroundColor="#cccc33",this.block.style.color="white";break;case 512:this.block.style.backgroundColor="#663399",this.block.style.color="white";break;case 1024:this.block.style.backgroundColor="#ff6666",this.block.style.color="white";break;case 2048:this.block.style.backgroundColor="#333399",this.block.style.color="white";break;case 4096:this.block.style.backgroundColor="#cc3366",this.block.style.color="white";break;case 8192:this.block.style.backgroundColor="#666666",this.block.style.color="white";break;case 16384:this.block.style.backgroundColor="#996600",this.block.style.color="white";break;case 32768:this.block.style.backgroundColor="#003300",this.block.style.color="white";break;case 65536:this.block.style.backgroundColor="#ccccff",this.block.style.color="white";break;case 131072:this.block.style.backgroundColor="#336666",this.block.style.color="white";break;case 262144:this.block.style.backgroundColor="#cc9966",this.block.style.color="white";break;case 524288:this.block.style.backgroundColor="#996633",this.block.style.color="white"}}}o.exports=i},function(o,t,i){function s(o){this.stage=document.getElementById(o+"Stage"),this.scoreBox=document.getElementById(o+"Score"),this.nameBox=document.getElementById(o+"Name"),this.control=o,this.init=function(){arguments[0]&&(this.ws=arguments[0],this.setNameBox(arguments[0].userName)),this.clearStage(),this.score=0,this.map=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.blkArr=[],this.maxNum=0,this.score=0,this.isKeyDown=0,this.isMove=0,this.moveNum=0,this.beginPos=[],"self"==this.control&&(this.rand(),this.rand(),this.rand(),window.onkeydown=function(t){if(!(o.isKeyDown||o.moveNum>=1)){o.moveNum++;var i=t||window.event;i&&(o.isKeyDown=1,o.slide(i.keyCode))}},window.onkeyup=function(){o.isKeyDown=0});var o=this;setInterval(function(){o.scoreBox.innerHTML=o.score},10)},this.createBlock=function(){for(;this.beginPos.length;){var o=new e,t=this.beginPos.shift(),i=t.x,s=t.y;this.blkArr.push(o),o.create(i,s,this.stage),o.setNumber(t.num),this.map[s][i]=o}},this.rand=function(){var o,t,i=Math.random()<=.6?2:4;for(o=Math.floor(4*Math.random()),t=Math.floor(4*Math.random());0!=this.map[t][o]||4==o||4==t;)o=Math.floor(4*Math.random()),t=Math.floor(4*Math.random());this.beginPos.push({x:o,y:t,num:i}),this.map[t][o]=1},this.setNameBox=function(o){this.nameBox.innerHTML=o},this.merge=function(o,t){var i=o.block.innerHTML,s=t.block.innerHTML;if(i==s){this.isMove||(this.isMove=1);var e=o.x,r=o.y;o.position(t.x,t.y),t.setNumber(2*s),o.block.style.zIndex=-1,this.map[r][e]=0,this.score+=2*s;var a=this;return setTimeout(function(){a.stage.removeChild(o.block),delete o},300),!0}return!1},this.slide=function(o){var t,i,s,e;if(37==o)for(t=0;4>t;t++){for(s=0,i=0;3>i;i++)if(0==this.map[t][i]){for(0==s&&(s=i+1);4>s&&0==this.map[t][s]&&s++;);if(4==s)break;this.map[t][s].position(i,t),this.map[t][i]=this.map[t][s],this.map[t][s]=0}for(i=0;3>i;i++)if(0!=this.map[t][i]&&0!=this.map[t][i+1]&&this.merge(this.map[t][i+1],this.map[t][i]))for(e=s=i+1;4>s;)0!=this.map[t][s]&&(this.map[t][s].position(e,t),this.map[t][e++]=this.map[t][s],this.map[t][s]=0),s++;for(s=0,i=0;3>i;i++)if(0==this.map[t][i]){for(0==s&&(s=i+1);4>s&&0==this.map[t][s]&&s++;);if(4==s)break;this.map[t][s].position(i,t),this.map[t][i]=this.map[t][s],this.map[t][s]=0}}if(38==o)for(t=0;4>t;t++){for(s=0,i=0;3>i;i++)if(0==this.map[i][t]){for(0==s&&(s=i+1);4>s&&0==this.map[s][t]&&s++;);if(4==s)break;this.map[s][t].position(t,i),this.map[i][t]=this.map[s][t],this.map[s][t]=0}for(i=0;3>i;i++)if(0!=this.map[i][t]&&0!=this.map[i+1][t]&&this.merge(this.map[i+1][t],this.map[i][t]))for(e=s=i+1;4>s;)0!=this.map[s][t]&&(this.map[s][t].position(t,e),this.map[e++][t]=this.map[s][t],this.map[s][t]=0),s++;for(s=0,i=0;3>i;i++)if(0==this.map[i][t]){for(0==s&&(s=i+1);4>s&&0==this.map[s][t]&&s++;);if(4==s)break;this.map[s][t].position(t,i),this.map[i][t]=this.map[s][t],this.map[s][t]=0}}if(39==o)for(t=0;4>t;t++){for(s=3,i=3;i>=1;i--)if(0==this.map[t][i]){for(3==s&&(s=i-1);s>=0&&0==this.map[t][s]&&s--;);if(-1==s)break;this.map[t][s].position(i,t),this.map[t][i]=this.map[t][s],this.map[t][s]=0}for(i=3;i>=1;i--)if(0!=this.map[t][i]&&0!=this.map[t][i-1]&&this.merge(this.map[t][i-1],this.map[t][i]))for(e=s=i-1;s>=0;)0!=this.map[t][s]&&(this.map[t][s].position(e,t),this.map[t][e--]=this.map[t][s],this.map[t][s]=0),s--;for(s=3,i=3;i>=1;i--)if(0==this.map[t][i]){for(3==s&&(s=i-1);s>=0&&0==this.map[t][s]&&s--;);if(-1==s)break;this.map[t][s].position(i,t),this.map[t][i]=this.map[t][s],this.map[t][s]=0}}if(40==o)for(t=0;4>t;t++){for(s=3,i=3;i>=1;i--)if(0==this.map[i][t]){for(3==s&&(s=i-1);s>=0&&0==this.map[s][t]&&s--;);if(-1==s)break;this.map[s][t].position(t,i),this.map[i][t]=this.map[s][t],this.map[s][t]=0}for(i=3;i>=1;i--)if(0!=this.map[i][t]&&0!=this.map[i-1][t]&&this.merge(this.map[i-1][t],this.map[i][t]))for(e=s=i-1;s>=0;)0!=this.map[s][t]&&(this.map[s][t].position(t,e),this.map[e--][t]=this.map[s][t],this.map[s][t]=0),s--;for(s=3,i=3;i>=1;i--)if(0==this.map[i][t]){for(3==s&&(s=i-1);s>=0&&0==this.map[s][t]&&s--;);if(-1==s)break;this.map[s][t].position(t,i),this.map[i][t]=this.map[s][t],this.map[s][t]=0}}if(40>=o&&o>=37){var r,a=this;setTimeout(function(){var s=0;for(t=0;4>t;t++)for(i=0;4>i;i++)0!=a.map[t][i]&&(s++,a.map[t][i].block.innerHTML>a.maxNum&&(a.maxNum=a.map[t][i].block.innerHTML));16!=s||a.isMove?(a.isMove=0,"self"==a.control&&(a.moveNum--,a.rand(),r={code:2,user:a.ws.userName,roomId:a.ws.roomId,token:a.ws.token,actionCode:o,beginPos:a.beginPos},a.ws.send(JSON.stringify(r))),a.createBlock()):(r={code:-2,user:a.ws.userName,roomId:a.ws.roomId,token:a.ws.token},a.ws.send(JSON.stringify(r)),a.init())},250)}},this.clearStage=function(){for(;this.stage.hasChildNodes();)this.stage.removeChild(this.stage.firstChild)}}var e=i(1);o.exports=s},function(o,t){function i(){for(var o;"undefined"==typeof o||""==o||null==o;)o=prompt("请输入您的昵称~");for(var t;"undefined"==typeof t||""==t||null==o;)t=prompt("请输入房间号");var i=1e12*Math.random();return{userName:o,roomId:t,token:i}}function s(o){setTimeout(function(){alert(o)},0)}o.exports={getUserInfo:i,asyncAlert:s}}]);