!function(o){function t(i){if(s[i])return s[i].exports;var e=s[i]={exports:{},id:i,loaded:!1};return o[i].call(e.exports,e,e.exports,t),e.loaded=!0,e.exports}var s={};return t.m=o,t.c=s,t.p="",t(0)}([function(o,t,s){!function(){function o(){if(!this.isClick){this.isClick=1,r.init(m),a.init(),this.innerHTML="已准备",this.style.backgroundColor="#1b76c4";var o={code:0,user:l.userName,roomId:l.roomId,token:l.token,beginPos:r.beginPos};m.send(JSON.stringify(o))}}function t(){n.innerHTML="准备",h.innerHTML="未准备",n.style.backgroundColor="#24a7f0",h.style.color="cornflowerblue"}var i=s(2),e=s(3),r=new i("self"),a=new i("com"),n=document.getElementById("readyBtn"),h=document.getElementsByClassName("state")[0],c=[];n.isClick=1,n.addEventListener("click",o),window.WebSocket||(alert("您的浏览器不支持多人2048，请升级！"),window.close());var l=e.getUserInfo(),m=new WebSocket("ws://127.0.0.1:9501");m.userName=l.userName,m.roomId=l.roomId,m.token=l.token,m.onopen=function(){console.log("connection success"),r.setNameBox(l.userName);var o={code:100,user:l.userName,roomId:l.roomId,token:l.token};m.send(JSON.stringify(o))},m.onmessage=function(o){var s=JSON.parse(o.data);if(100==s.code&&(a.setNameBox(s.comp),n.isClick=0),-50==s.code){for(l.roomId=prompt("房间已满，请重新输入房间号:");"undefined"==typeof l.roomId||""==l.roomId;)l.roomId=prompt("房间已满，请重新输入房间号:");m.roomId=l.roomId;var i={code:100,user:l.userName,roomId:l.roomId,token:l.token};m.send(JSON.stringify(i))}0==s.code&&(h.innerHTML="已准备",h.style.color="coral"),-1==s.code&&(alert("对方已离开房间,您可以继续玩！"),a.init(),a.setNameBox("虚位以待"),t()),1==s.code&&(h.innerHTML="进行中",h.style.color="coral",n.innerHTML="进行中",n.backgroundColor="coral",r.createBlock(),a.beginPos=s.beginPos,a.createBlock()),2==s.code&&(c.push({actionCode:s.actionCode,nwPos:s.nwPos}),a.comHandle(c)),3!=s.code&&-3!=s.code&&66!=s.code||(3==s.code?alert("你赢了!"):-3==s.code?alert("你输了!"):alert("平局!"),t(),a.init(),r.init(),n.isClick=0)},m.onclose=function(){console.log("断开连接")},m.onerror=function(){console.log("error")}}()},function(o,t){function s(){this.number=0,this.position=function(o,t){this.x=o,this.y=t,this.block.style.marginLeft=o*(this.width+this.offset)+"px",this.block.style.marginTop=t*(this.height+this.offset)+"px"},this.create=function(o,t,s){var i=document.createElement("div");i.className="block",this.block=i,this.width=this.height=100,this.x=o,this.y=t,this.offset=7,this.position(o,t),s.appendChild(i)},this.setNumber=function(o){switch(this.number=o,this.block.innerHTML=o,parseInt(this.number)){case 2:this.block.style.backgroundColor="#3399cc",this.block.style.color="white";break;case 4:this.block.style.backgroundColor="#ff9900",this.block.style.color="white";break;case 8:this.block.style.backgroundColor="#ffcc33",this.block.style.color="white";break;case 16:this.block.style.backgroundColor="#ff6600",this.block.style.color="white";break;case 32:this.block.style.backgroundColor="#009966",this.block.style.color="white";break;case 64:this.block.style.backgroundColor="#33cc99",this.block.style.color="white";break;case 128:this.block.style.backgroundColor="#cc6600",this.block.style.color="white";break;case 256:this.block.style.backgroundColor="#cccc33",this.block.style.color="white";break;case 512:this.block.style.backgroundColor="#663399",this.block.style.color="white";break;case 1024:this.block.style.backgroundColor="#ff6666",this.block.style.color="white";break;case 2048:this.block.style.backgroundColor="#333399",this.block.style.color="white";break;case 4096:this.block.style.backgroundColor="#cc3366",this.block.style.color="white";break;case 8192:this.block.style.backgroundColor="#666666",this.block.style.color="white";break;case 16384:this.block.style.backgroundColor="#996600",this.block.style.color="white";break;case 32768:this.block.style.backgroundColor="#003300",this.block.style.color="white";break;case 65536:this.block.style.backgroundColor="#ccccff",this.block.style.color="white";break;case 131072:this.block.style.backgroundColor="#336666",this.block.style.color="white";break;case 262144:this.block.style.backgroundColor="#cc9966",this.block.style.color="white";break;case 524288:this.block.style.backgroundColor="#996633",this.block.style.color="white"}}}o.exports=s},function(o,t,s){function i(o){this.stage=document.getElementById(o+"Stage"),this.scoreBox=document.getElementById(o+"Score"),this.nameBox=document.getElementById(o+"Name"),this.control=o,this.init=function(){arguments[0]&&(this.ws=arguments[0],this.setNameBox(arguments[0].userName)),this.clearStage(),this.score=0,this.map=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.blkArr=[],this.maxNum=0,this.score=0,this.isKeyDown=0,this.isMove=0,this.moveNum=0,this.beginPos=[],"self"==this.control&&(this.rand(),this.rand(),this.rand(),window.onkeydown=function(t){if(!(o.isKeyDown||o.moveNum>=1)){var s=t||window.event;s&&s.keyCode>=37&&s.keyCode<=40&&(o.isKeyDown=1,o.slide(s.keyCode),o.moveNum++)}},window.onkeyup=function(){o.isKeyDown=0});var o=this;setInterval(function(){o.scoreBox.innerHTML=o.score},10)},this.createBlock=function(){for(;this.beginPos.length;){var o=new e,t=this.beginPos.shift(),s=t.x,i=t.y;this.blkArr.push(o),o.create(s,i,this.stage),o.setNumber(t.num),this.map[i][s]=o}},this.rand=function(){var o,t,s=Math.random()<=.6?2:4;for(o=Math.floor(4*Math.random()),t=Math.floor(4*Math.random());0!=this.map[t][o]||4==o||4==t;)o=Math.floor(4*Math.random()),t=Math.floor(4*Math.random());this.beginPos.push({x:o,y:t,num:s}),this.map[t][o]=1},this.setNameBox=function(o){this.nameBox.innerHTML=o},this.merge=function(o,t){var s=o.block.innerHTML,i=t.block.innerHTML;if(s==i){this.isMove||(this.isMove=1);var e=o.x,r=o.y;o.position(t.x,t.y),t.setNumber(2*i),o.block.style.zIndex=-1,this.map[r][e]=0,this.score+=2*i;var a=this;return setTimeout(function(){a.stage.removeChild(o.block),delete o},300),!0}return!1},this.slide=function(o){var t,s,i,e;if(37==o)for(t=0;4>t;t++){for(i=0,s=0;3>s;s++)if(0==this.map[t][s]){for(0==i&&(i=s+1);4>i&&0==this.map[t][i]&&i++;);if(4==i)break;this.map[t][i].position(s,t),this.map[t][s]=this.map[t][i],this.map[t][i]=0}for(s=0;3>s;s++)if(0!=this.map[t][s]&&0!=this.map[t][s+1]&&this.merge(this.map[t][s+1],this.map[t][s]))for(e=i=s+1;4>i;)0!=this.map[t][i]&&(this.map[t][i].position(e,t),this.map[t][e++]=this.map[t][i],this.map[t][i]=0),i++;for(i=0,s=0;3>s;s++)if(0==this.map[t][s]){for(0==i&&(i=s+1);4>i&&0==this.map[t][i]&&i++;);if(4==i)break;this.map[t][i].position(s,t),this.map[t][s]=this.map[t][i],this.map[t][i]=0}}if(38==o)for(t=0;4>t;t++){for(i=0,s=0;3>s;s++)if(0==this.map[s][t]){for(0==i&&(i=s+1);4>i&&0==this.map[i][t]&&i++;);if(4==i)break;this.map[i][t].position(t,s),this.map[s][t]=this.map[i][t],this.map[i][t]=0}for(s=0;3>s;s++)if(0!=this.map[s][t]&&0!=this.map[s+1][t]&&this.merge(this.map[s+1][t],this.map[s][t]))for(e=i=s+1;4>i;)0!=this.map[i][t]&&(this.map[i][t].position(t,e),this.map[e++][t]=this.map[i][t],this.map[i][t]=0),i++;for(i=0,s=0;3>s;s++)if(0==this.map[s][t]){for(0==i&&(i=s+1);4>i&&0==this.map[i][t]&&i++;);if(4==i)break;this.map[i][t].position(t,s),this.map[s][t]=this.map[i][t],this.map[i][t]=0}}if(39==o)for(t=0;4>t;t++){for(i=3,s=3;s>=1;s--)if(0==this.map[t][s]){for(3==i&&(i=s-1);i>=0&&0==this.map[t][i]&&i--;);if(-1==i)break;this.map[t][i].position(s,t),this.map[t][s]=this.map[t][i],this.map[t][i]=0}for(s=3;s>=1;s--)if(0!=this.map[t][s]&&0!=this.map[t][s-1]&&this.merge(this.map[t][s-1],this.map[t][s]))for(e=i=s-1;i>=0;)0!=this.map[t][i]&&(this.map[t][i].position(e,t),this.map[t][e--]=this.map[t][i],this.map[t][i]=0),i--;for(i=3,s=3;s>=1;s--)if(0==this.map[t][s]){for(3==i&&(i=s-1);i>=0&&0==this.map[t][i]&&i--;);if(-1==i)break;this.map[t][i].position(s,t),this.map[t][s]=this.map[t][i],this.map[t][i]=0}}if(40==o)for(t=0;4>t;t++){for(i=3,s=3;s>=1;s--)if(0==this.map[s][t]){for(3==i&&(i=s-1);i>=0&&0==this.map[i][t]&&i--;);if(-1==i)break;this.map[i][t].position(t,s),this.map[s][t]=this.map[i][t],this.map[i][t]=0}for(s=3;s>=1;s--)if(0!=this.map[s][t]&&0!=this.map[s-1][t]&&this.merge(this.map[s-1][t],this.map[s][t]))for(e=i=s-1;i>=0;)0!=this.map[i][t]&&(this.map[i][t].position(t,e),this.map[e--][t]=this.map[i][t],this.map[i][t]=0),i--;for(i=3,s=3;s>=1;s--)if(0==this.map[s][t]){for(3==i&&(i=s-1);i>=0&&0==this.map[i][t]&&i--;);if(-1==i)break;this.map[i][t].position(t,s),this.map[s][t]=this.map[i][t],this.map[i][t]=0}}"self"==this.control&&this.selfCheck(o)},this.selfCheck=function(o){var t,s,i,e=this;setTimeout(function(){var r=0;for(s=0;4>s;s++)for(i=0;4>i;i++)0!=e.map[s][i]&&(r++,e.map[s][i].block.innerHTML>e.maxNum&&(e.maxNum=e.map[s][i].block.innerHTML));16!=r||e.isMove?(e.isMove=0,e.moveNum--,e.rand(),t={code:2,user:e.ws.userName,roomId:e.ws.roomId,token:e.ws.token,actionCode:o,nwPos:e.beginPos[0]},e.ws.send(JSON.stringify(t)),e.createBlock()):(alert("游戏结束,您的分数为["+e.score+"]."),t={code:-2,user:e.ws.userName,roomId:e.ws.roomId,token:e.ws.token,score:e.score},e.ws.send(JSON.stringify(t)))},250)},this.comHandle=function(o){for(var t;o.length;)t=o.shift(),this.beginPos.push(t.nwPos),this.slide(t.actionCode),this.createBlock()},this.clearStage=function(){for(;this.stage.hasChildNodes();)this.stage.removeChild(this.stage.firstChild)}}var e=s(1);o.exports=i},function(o,t){function s(){for(var o;"undefined"==typeof o||""==o||null==o;)o=prompt("请输入您的昵称~");for(var t;"undefined"==typeof t||""==t||null==o;)t=prompt("请输入房间号");var s=1e12*Math.random();return{userName:o,roomId:t,token:s}}o.exports={getUserInfo:s}}]);